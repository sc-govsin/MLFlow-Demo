# ðŸš€ IoT Water Meter Anomaly Detection

This repository implements a complete anomaly detection system for IoT water meters using various machine learning models. It includes data preprocessing, feature engineering, model training with imbalance handling, experiment tracking, and deployment-ready wrappers.

---

## ðŸ“ Folder Structure

```

â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ LogisticRegression/
â”‚   â”‚   â”œâ”€â”€ LogisticRegression.pkl
â”‚   â”‚   â”œâ”€â”€ standard\_scaler.pkl
â”‚   â”‚   â”œâ”€â”€ reference\_data.csv
â”‚   â”‚   â””â”€â”€ confusion\_matrix.png
â”‚   â”œâ”€â”€ RandomForest/
â”‚   â”œâ”€â”€ XGBoost/
â”‚   â””â”€â”€ LSTM/
â”‚
â”œâ”€â”€ logistic\_regression\_pipeline.txt   # Notebook-style script for LR
â”œâ”€â”€ random\_forest\_pipeline.ipynb
â”œâ”€â”€ xgboost\_pipeline.ipynb
â”œâ”€â”€ lstm\_pipeline.ipynb
â”œâ”€â”€ README.md

````

---

## âœ… Models Used

| Model              | Notes                                  |
|-------------------|----------------------------------------|
| Logistic Regression | Baseline linear model with SMOTE       |
| Random Forest       | Tree-based ensemble classifier         |
| XGBoost             | Boosted gradient trees for better ROC  |
| LSTM                | Deep learning model on sequence data   |

---

## ðŸ“Š Key Features

- ðŸ“¥ Download + preprocess water meter data
- ðŸ§¬ Feature engineering (e.g., part of day, diff, encoded time)
- âš–ï¸ Imbalance handling with **SMOTE**
- ðŸ“ˆ Model training + scoring
- ðŸ§ª MLflow logging:
  - Parameters
  - Metrics (precision, recall, F1)
  - Confusion matrix
  - `reference_data.csv` for monitoring
- ðŸ§© PyFunc wrappers for structured prediction
- âœ… Compatible with **Evidently AI** (`column_mapping` logged in each run)

---

## ðŸ§ª Running Experiments

Each experiment is a standalone notebook or script.  
After editing or training:

```bash
# Run Logistic Regression
python logistic_regression_pipeline.txt

# For notebooks
jupyter notebook random_forest_pipeline.ipynb
````

---

## ðŸ§° Requirements

Install dependencies via pip:

```bash
pip install -r requirements.txt
```

Or manually:

```bash
pip install pandas numpy scikit-learn matplotlib seaborn imbalanced-learn mlflow xgboost
```

> For LSTM:

```bash
pip install tensorflow
```

---

## ðŸ”® Column Mapping for Evidently

Each model directory contains `reference_data.csv`, and each MLflow run logs:

```json
{
  "numerical_features": [...],
  "categorical_features": [],
  "text_features": [],
  "input_features": [...],
  "predicted_features": ["prediction"]
}
```

---

## ðŸ§ª Example Results

| Model              | Precision | Recall | F1 Score |
| ------------------ | --------- | ------ | -------- |
| LogisticRegression | 0.88      | 0.83   | 0.85     |
| RandomForest       | 0.91      | 0.89   | 0.90     |
| XGBoost            | 0.92      | 0.90   | 0.91     |
| LSTM               | 0.93      | 0.91   | 0.92     |
